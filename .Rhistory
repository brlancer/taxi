library(bigrquery)
sql <- paste0("SELECT ROUND(pickup_latitude, 4) as lat, ROUND(pickup_longitude, 4) as long, COUNT(*) as num_pickups,
FROM [nyc-tlc:yellow.trips_2014]
WHERE fare_amount/trip_distance BETWEEN 2 AND 10
GROUP BY lat, long")
project <- "charismatic-sum-103015" # "your bigquery project name"
df <- query_exec(sql, project = project,
default_dataset = "nyc-tlc:yellow.trips_2014",
max_pages = Inf)
setwd("~/taxi")
write.csv(df, "data/yellow_pickups_2014.csv", row.names = F)
library(dplyr); library(ggplot2); library(ggthemes)
lim_long <- c(-74.1, -73.7); lim_lat <- c(40.5, 41.0) # set lat/long ranges
df_sample <- sample_n(df, size = 300000)
data <- df_sample
?logb
alpha_thresh <- median(data$num_pickups, na.rm = FALSE)
log(15,4)
log(4,4)
log(3,4)
p <- ggplot(data, aes(long, lat)) + theme_tufte() +
geom_point(aes(alpha = log(num_pickups, base = alpha_thresh)),
size=0.1, colour = "#FFFF00") +
xlim(lim_long[1], lim_long[2]) + ylim(lim_lat[1], lim_lat[2]) +
theme(legend.position = "none", axis.ticks = element_blank(),
axis.text = element_blank(), axis.title = element_blank(),
panel.background = element_rect(fill = "black"),
plot.background = element_rect(fill = "black"))
scale_plot_size <- 20
plot_height <- lim_lat[2] - lim_lat[1]
plot_width <- lim_long[2] - lim_long[1]
ggsave(file = paste0("fig/plot",strftime(Sys.time(), "_%H%M%S_%d%m%y"),".png"), plot = p,
width = plot_width*scale_plot_size, height = plot_height*scale_plot_size,
units = c("in"), dpi = 300)
data <- df
p <- ggplot(data, aes(long, lat)) + theme_tufte() +
geom_point(aes(alpha = log(num_pickups, base = alpha_thresh)),
size=0.1, colour = "#FFFF00") +
xlim(lim_long[1], lim_long[2]) + ylim(lim_lat[1], lim_lat[2]) +
theme(legend.position = "none", axis.ticks = element_blank(),
axis.text = element_blank(), axis.title = element_blank(),
panel.background = element_rect(fill = "black"),
plot.background = element_rect(fill = "black"))
scale_plot_size <- 20
# Calculations for plot parameters
plot_height <- lim_lat[2] - lim_lat[1]
plot_width <- lim_long[2] - lim_long[1]
# Save as PNG. You can switch this to PDF but the files are clunky.
ggsave(file = paste0("fig/plot",strftime(Sys.time(), "_%H%M%S_%d%m%y"),".png"), plot = p,
width = plot_width*scale_plot_size, height = plot_height*scale_plot_size,
units = c("in"), dpi = 300)
